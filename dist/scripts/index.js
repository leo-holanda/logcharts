(()=>{async function v(){return await fetch("./assets/example.CSV").then(t=>t.text())}function E(t){if(t.type=="text/csv"||t.type=="application/vnd.ms-excel"||!t.type)return!0}function B(t){if(t.includes("Time"))return!0}function z(t){for(var e=t.length,i,n;e!==0;)n=Math.floor(Math.random()*e),e-=1,i=t[e],t[e]=t[n],t[n]=i;return t}function w(){for(var t=["a","b","c","d","e","f","0","1","2","3","4","5","6","7","8","9"],e="#",i=0;i<6;i++)z(t),e+=t[0];return e}function V(t){return!["Date","Time",""].includes(t)}function s(t){if(t){let e=t.split(":"),i=new Date;if(i.setHours(e[0]),i.setMinutes(e[1]),i.setSeconds(e[2]),!isNaN(i.getTime()))return i}}function l(t){if(t){if(t=="No")return 0;if(t=="Yes")return 1;if(!isNaN(t))return parseFloat(t)}}function q(t){let e=document.body.clientWidth,i=document.querySelector(".chart-svg").getBoundingClientRect().width,n=e-i;return t.tooltipCircle.node().getBoundingClientRect().left+t.tooltipBackground.node().getBoundingClientRect().width-n>t.chart.width}function y(t,e){let i=t.tooltipBackground.node().getBoundingClientRect().width+15,n=e?-i:15,o=e?-i+5:20;t.tooltip.node().setAttribute("x",n),t.tooltipBackground.node().setAttribute("x",n),t.tooltipBackgroundStroke.node().setAttribute("x",n),t.tooltipTime.node().setAttribute("dx",o)}function A(t){let e=t.tooltipCircle.node().getBoundingClientRect(),i=(document.querySelectorAll(".selector-btn").length-1)*15,n=e.bottom+20+i,o=document.querySelector(".domain").getBoundingClientRect().y;return n>o}function x(t,e){let i=t.tooltipCircle.node().getBoundingClientRect(),n=(document.querySelectorAll(".selector-btn").length-1)*15,o=i.bottom+20+n,r=document.querySelector(".domain").getBoundingClientRect().y,c=o-r+n,a=e?-21-c:-21,d=e?15-c:15;t.tooltip.node().setAttribute("y",a),t.tooltipBackground.node().setAttribute("y",a),t.tooltipBackgroundStroke.node().setAttribute("y",a),t.tooltipTime.node().setAttribute("dy",d)}function F(t,e){let i=d3.bisector(a=>s(a.Time)).center,n=e.invert(d3.pointer(event,this)[0]),o=i(t.chart.log,n,1),r=t.chart.log[o-1],c=t.chart.log[o];return c&&n-s(r.Time)>s(c.Time)-n?c:r}function H(t,e,i,n){let o=t+": "+l(e[t]),r=i.tooltipBackground.node().getBoundingClientRect().width+15,c=n?-r+5:20;i.tooltipText.append("tspan").text(o).attr("id",t).attr("class","tooltip-value").attr("x",c).attr("dy",15)}function G(){let t=document.createElement("button"),e=document.createElement("span");e.classList.add("material-icons-round"),e.innerHTML="add_circle",t.classList.add("add-selector-btn"),t.id="add_selector_btn",t.addEventListener("click",$),t.appendChild(e),document.querySelector(".selector-container").appendChild(t)}function S(t,e,i){let n=document.querySelector(".selector-btn-container"),o=!1;n.children.length==0&&(o=!0);let r=document.createElement("div");r.classList.add("selector-div"),r.style.borderBottom="3px solid "+e;let c=document.createElement("div");c.classList.add("color-picker"),r.appendChild(c);let a=document.createElement("input");a.setAttribute("type","radio"),a.setAttribute("id",t),a.setAttribute("name","selector-btn"),o&&(a.checked=!0),a.classList.add("selector-btn");let d=document.createElement("label");if(d.innerHTML=i,r.appendChild(a),r.appendChild(d),n.appendChild(r),Pickr.create({el:".color-picker",theme:"nano",default:e,defaultRepresentation:"HEX",swatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63, 81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3, 169, 244, 1)","rgba(0, 188, 212, 1)","rgba(0, 150, 136, 1)","rgba(76, 175, 80, 1)","rgba(139, 195, 74, 1)","rgba(205, 220, 57, 1)","rgba(255, 235, 59, 1)","rgba(255, 193, 7, 1)"],components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}}).on("change",function(h,u,g){document.querySelector("path#"+t).setAttribute("stroke",h.toHEXA()),r.style.borderBottom="3px solid "+h.toHEXA(),g.applyColor(g._lastColor)}),!o){let h=document.createElement("i");h.classList.add("fas"),h.classList.add("fa-trash"),h.addEventListener("click",function(){document.querySelector("path#"+t).remove(),r.remove()});let u;for(u of document.querySelectorAll(".pickr"))u.contains(h)||u.appendChild(h)}}function $(){let t=w(),e="id"+new Date().valueOf();S(e,t,m.defaultField),m.addNewLine(e,t)}function p(t){this.log=t.parsedLog,this.container=t.container,this.defaultField=t.defaultField;let e=this.container.clientHeight,i=this.container.clientWidth;this.margin={top:50,right:50,bottom:40,left:60},this.width=i-this.margin.left-this.margin.right,this.height=e-this.margin.top-this.margin.bottom-100,this.brushHeight=80}p.prototype.draw=function(){this.chartSVG=d3.select(this.container).append("svg").attr("class","chart-svg").attr("viewBox",`0 0 ${this.width} ${this.height}`),this.contextSVG=d3.select(this.container).append("svg").attr("class","context-svg").attr("viewBox",`0 0 ${this.width} 100`),this.clip=this.chartSVG.append("clipPath").attr("id","line_clip").append("rect").attr("transform",`translate(${this.margin.left}, 0)`).attr("width",this.width-this.margin.right*2-9).attr("height",this.height),this.addScales(),this.addAxes(),this.addGrid(),this.addMainLine(),this.addBrush(),this.addTooltip()};p.prototype.addScales=function(){this.xScale=d3.scaleTime().domain(d3.extent(this.log,t=>s(t.Time))).range([this.margin.left,this.width-this.margin.right]),this.yScale=d3.scaleLinear().domain(d3.extent(this.log,t=>l(t[this.defaultField]))).nice().range([this.height-this.margin.bottom,this.margin.top]),this.yContextScale=d3.scaleLinear().domain(d3.extent(this.log,t=>l(t[this.defaultField]))).range([this.brushHeight,this.margin.top])};p.prototype.addAxes=function(){this.xAxis=(t,e=1e3,i=this.xScale,n=this.height,o=this.margin.bottom)=>t.attr("transform",`translate(0, ${n-o})`).transition().duration(e).call(d3.axisBottom(i)).attr("class","x-axis"),this.chartSVG.append("g").call(this.xAxis),this.contextSVG.append("g").call(this.xAxis,1e3,this.xScale,100,20),this.yAxis=t=>t.attr("transform",`translate(${this.margin.left},0)`).transition().duration(1e3).call(d3.axisLeft(this.yScale)).call(e=>e.select(".domain").remove()).attr("class","y-axis"),this.chartSVG.append("g").call(this.yAxis)};p.prototype.addGrid=function(){this.chartSVG.append("g").attr("class","grid").attr("transform",`translate(${this.margin.left}, 0)`).call(d3.axisLeft(this.yScale).tickSize(-this.width+this.margin.right*2).tickFormat("")).call(t=>t.select(".domain").remove())};p.prototype.addMainLine=function(){let t="id"+new Date().valueOf();S(t,"#4E7BFF",this.defaultField),this.chartSVG.append("path").datum(this.log).attr("clip-path","url(#line_clip)").attr("fill","none").attr("stroke","#4E7BFF").attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","chart-line").attr("id",t).attr("d",d3.line().defined(e=>l(e[this.defaultField])!==void 0).x(e=>this.xScale(s(e.Time))).y(e=>this.yScale(l(e[this.defaultField])))),this.contextSVG.append("path").datum(this.log).attr("fill","none").attr("stroke","#4E7BFF").attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","context-line").attr("d",d3.line().defined(e=>l(e[this.defaultField])!==void 0).x(e=>this.xScale(s(e.Time))).y(e=>this.yContextScale(l(e[this.defaultField]))))};p.prototype.addNewLine=function(t,e,i=this.xScale.copy(),n=this.yScale.copy()){this.brushedXScale?i=this.brushedXScale:i.domain(d3.extent(this.log,o=>s(o.Time))),n.domain(d3.extent(this.log,o=>l(o[this.defaultField]))).nice(),this.chartSVG.insert("path",".tooltip").datum(this.log).attr("clip-path","url(#line_clip)").attr("fill","none").attr("stroke",e).attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","chart-line").attr("field",this.defaultField).attr("id",t).attr("d",d3.line().defined(o=>l(o[this.defaultField])!==void 0).x(o=>i(s(o.Time))).y(o=>n(l(o[this.defaultField]))))};p.prototype.updateLineByField=function(t,e,i=this.xScale.copy(),n=this.yScale.copy()){this.brushedXScale?i=this.brushedXScale:i.domain(d3.extent(this.log,o=>s(o.Time))),n.domain(d3.extent(this.log,o=>l(o[t]))).nice(),this.chartSVG.select("#"+e).transition().duration(1e3).attr("field",t).attr("d",d3.line().defined(o=>l(o[t])!==void 0).x(o=>i(s(o.Time))).y(o=>n(l(o[t]))))};p.prototype.updateMainLine=function(t){this.brushedXScale=void 0,this.selectedField=t,this.chartSVG.select(".chart-line")._groups[0][0].setAttribute("field",t),this.xScale.domain(d3.extent(this.log,n=>s(n.Time))),this.yScale.domain(d3.extent(this.log,n=>l(n[t]))).nice(),this.yContextScale.domain(d3.extent(this.log,n=>l(n[t]))),this.chartSVG.select(".x-axis").call(this.xAxis),this.chartSVG.select(".y-axis").transition().duration(1e3).call(this.yAxis),this.chartSVG.select(".grid").attr("transform",`translate(${this.margin.left}, 0)`).call(d3.axisLeft(this.yScale).tickSize(-this.width+this.margin.right*2).tickFormat("")).call(n=>n.select(".domain").remove()),this.chartSVG.select(".grid").selectAll(".tick").size()==1&&this.chartSVG.select(".grid").select(".tick").remove(),this.chartSVG.select(".chart-line").transition().duration(1e3).attr("d",d3.line().defined(n=>l(n[t])!==void 0).x(n=>this.xScale(s(n.Time))).y(n=>this.yScale(l(n[t])))),this.contextSVG.select(".context-line").transition().duration(1e3).attr("d",d3.line().defined(n=>l(n[t])!==void 0).x(n=>this.xScale(s(n.Time))).y(n=>this.yContextScale(l(n[t])))),this.contextSVG.select(".brush").transition().duration(1e3).call(this.brush.move,this.xScale.range()),this.chartSVG.select(".chart-line")._groups[0][0].setAttribute("domain",this.xScale.domain());let e=this.yScale.copy(),i;for(i of document.querySelectorAll(".selector-btn"))t=i.parentNode.querySelector("label").innerHTML,e.domain(d3.extent(this.log,n=>l(n[t]))).nice(),this.chartSVG.select("#"+i.id).transition().duration(1e3).attr("d",d3.line().defined(n=>l(n[t])!==void 0).x(n=>this.xScale(s(n.Time))).y(n=>e(l(n[t]))))};p.prototype.addBrush=function(){this.brush=d3.brushX().extent([[this.margin.left,0],[this.width-this.margin.right,this.brushHeight]]).on("brush",t=>{if(t.sourceEvent){let e=t.selection;this.updateByBrush(e)}}),this.contextSVG.append("g").attr("class","brush").call(this.brush).call(this.brush.move,this.xScale.range())};p.prototype.updateByBrush=function(t,e=this.xScale.copy(),i=this.yScale.copy()){e.domain([e.invert(t[0]),e.invert(t[1])]),this.brushedXScale=e,this.chartSVG.select(".x-axis").call(this.xAxis,0,e);let n,o;for(o of document.querySelectorAll(".selector-btn"))n=o.parentNode.querySelector("label").innerHTML,i.domain(d3.extent(this.log,r=>l(r[n]))).nice(),this.chartSVG.select("#"+o.id).attr("d",d3.line().defined(r=>l(r[n])!==void 0).x(r=>e(s(r.Time))).y(r=>i(l(r[n]))))};p.prototype.addTooltip=function(){let t=this.chartSVG.append("g").attr("class","tooltip"),e=this.chartSVG.append("line").attr("class","tooltip-line").style("stroke","black").style("stroke-width",2).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",this.height-this.margin.bottom,this.margin.top),i=t.append("circle").attr("class","tooltip-circle").attr("r",5),n=t.append("rect").attr("class","tooltip-background").attr("width",100).attr("height",30).attr("x",15).attr("y",-21),o=t.append("rect").attr("class","tooltip-background-stroke").attr("width",100).attr("height",30).attr("x",15).attr("y",-21),r=t.append("text").attr("class","tooltip-value-container").attr("width",100).attr("height",30).attr("dx",15).attr("y",-15),c=r.append("tspan").attr("class","tooltip-time").attr("dy",15),a=this,d={tooltip:t,line:e,tooltipCircle:i,tooltipBackground:n,tooltipBackgroundStroke:o,tooltipText:r,tooltipTime:c,chart:a};this.chartSVG.on("touchmove mousemove",function(){t.selectAll(".tooltip-value").remove();let f=q(d);f?y(d,!0):y(d,!1),A(d)?x(d,!0):x(d,!1);let h=a.brushedXScale?a.brushedXScale:a.xScale,u=F(d,h),g,L;for(g of document.querySelectorAll(".selector-btn"))L=g.parentNode.querySelector("label").innerHTML,H(L,u,d,f);let C=r.node().getBoundingClientRect(),T=C.height+10,k=C.width+10;n.node().setAttribute("height",T),n.node().setAttribute("width",k),o.node().setAttribute("height",T),o.node().setAttribute("width",k);let D=document.querySelector(".selector-div").lastChild.innerHTML,W=a.yScale;e.attr("transform","translate("+h(s(u.Time))+",0)"),t.attr("transform","translate("+h(s(u.Time))+","+W(l(u[D]))+")"),t.select(".tooltip-time").text(s(u.Time).toLocaleTimeString())}),this.chartSVG.on("mouseover",function(){t.style("display",null),e.style("display",null)}),this.chartSVG.on("mouseout",function(){t.style("display","none"),e.style("display","none")})};function M(t,e){let i,n,o,r=t.map(d=>l(d[e])),c=d3.extent(r),a=0;for(a;a<3;a++){switch(i=document.createElement("div"),n=document.createElement("span"),o=document.createElement("h4"),i.classList.add("stats"),n.classList.add("stats-title"),o.classList.add("stats-value"),a){case 0:i.id="min_value",o.innerHTML=c[0],n.innerHTML="Minimum";break;case 1:i.id="mean",o.innerHTML=d3.mean(r).toFixed(2),n.innerHTML="Mean";break;case 2:i.id="max_value",o.innerHTML=c[1],n.innerHTML="Maximum";break}document.querySelector(".stats-container").appendChild(i),i.appendChild(o),i.appendChild(n)}}function R(t,e){let i=t.map(d=>l(d[e])),n=d3.extent(i),o=d3.mean(i).toFixed(2),r=document.querySelector("#min_value"),c=document.querySelector("#mean"),a=document.querySelector("#max_value");r.children[0].innerHTML=n[0],c.children[0].innerHTML=o,a.children[0].innerHTML=n[1]}function b(t,e,i=void 0){if(i&&(t=t.filter(r=>r&&r.toLowerCase().includes(i.toLowerCase())),t.length==0)){document.querySelector(".btn-container").innerHTML="The search didn't found a field with your search string.";return}let n;t.forEach(r=>{r&&!r.includes("Time")&&!r.includes("Date")&&(n=document.createElement("button"),n.id=r,n.innerHTML=r,n.classList.add("field-btn"),document.querySelector(".btn-container").appendChild(n))}),document.getElementById(e).scrollIntoView({block:"center"})}function _(){document.querySelector(".btn-container").addEventListener("click",t=>{t.target.className=="field-btn"&&j(t.target.innerHTML)})}function j(t){let e=document.querySelector(".selector-btn:checked");e.parentNode.querySelector("label").innerHTML=t;let i=document.querySelector(".selector-btn:first-of-type");e.id==i.id?(m.updateMainLine(t),R(m.log,t)):m.updateLineByField(t,e.id)}function U(){document.querySelector(".form-container").remove();let t;(t=document.querySelector(".loader-wrapper"))&&t.remove(),document.querySelector(".header").remove()}function I(t){if(document.querySelector(".form-alert")!=null){document.querySelector(".form-alert").innerHTML=t;return}let e=document.createElement("h3");e.innerHTML=t,e.classList.add("form-alert"),document.querySelector(".third-step").appendChild(e)}function O(){document.querySelector(".btn-container").replaceChildren(),b(N,m.defaultField,this.value)}function Y(){let t=document.createElement("span");t.classList.add("material-icons-round"),t.classList.add("field-search-icon"),t.textContent="search",document.querySelector(".field-search-container").appendChild(t);let e=document.createElement("input");e.type="text",e.placeholder="Search by field",e.classList.add("field-search-input"),e.addEventListener("input",O),document.querySelector(".field-search-container").appendChild(e)}function J(){document.querySelector("main").classList.remove("aligned");let t=document.createElement("div");t.classList.add("field-container"),document.querySelector("main").appendChild(t);let e=document.createElement("h4");e.innerHTML="FIELDS",e.classList.add("field-container-title"),document.querySelector(".field-container").appendChild(e),t=document.createElement("div"),t.classList.add("field-search-container"),document.querySelector(".field-container").appendChild(t),t=document.createElement("div"),t.classList.add("btn-container"),document.querySelector(".field-container").appendChild(t),t=document.createElement("div"),t.classList.add("repo-btn-container"),document.querySelector(".field-container").appendChild(t),t=document.createElement("div"),t.classList.add("report-container"),document.querySelector("main").appendChild(t),t=document.createElement("div"),t.classList.add("stats-container"),document.querySelector(".report-container").appendChild(t),t=document.createElement("div"),t.classList.add("selector-container"),document.querySelector(".report-container").appendChild(t),t=document.createElement("div"),t.classList.add("selector-btn-container"),document.querySelector(".selector-container").appendChild(t),t=document.createElement("div"),t.classList.add("chart-container"),document.querySelector(".report-container").appendChild(t)}function K(){let t=document.documentElement.getAttribute("data-theme"),e=t=="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e);let i=document.querySelector("#theme_icon");i.textContent=t+"_mode",localStorage.setItem("theme",e)}function P(){let t=document.createElement("a");t.setAttribute("href","https://github.com/leo-holanda/logcharts.io/issues/new"),t.setAttribute("target","_blank"),t.classList.add("repo-btn-link");let e=document.createElement("span");e.classList.add("material-icons-round"),e.textContent="bug_report";let i=document.createElement("span");i.textContent="Report a bug";let n=document.createElement("button");n.appendChild(e),n.appendChild(i),n.setAttribute("type","button"),n.classList.add("repo-btn"),t.appendChild(n),document.querySelector(".repo-btn-container").appendChild(t);let o=document.createElement("a");o.setAttribute("href","https://github.com/leo-holanda/logcharts.io"),o.setAttribute("target","_blank"),o.classList.add("repo-btn-link");let r=document.createElement("span");r.classList.add("material-icons-round"),r.textContent="star";let c=document.createElement("span");c.textContent="Star the GitHub Repo";let a=document.createElement("button");a.appendChild(r),a.appendChild(c),a.setAttribute("type","button"),a.classList.add("repo-btn"),o.appendChild(a),document.querySelector(".repo-btn-container").appendChild(o);let d=document.documentElement.getAttribute("data-theme"),f=document.createElement("span");f.id="theme_icon",f.classList.add("material-icons-round"),f.textContent=(d=="light"?"dark":"light")+"_mode";let h=document.createElement("span");h.textContent="Change theme";let u=document.createElement("button");u.appendChild(f),u.appendChild(h),u.setAttribute("type","button"),u.classList.add("repo-btn"),u.addEventListener("click",K),document.querySelector(".repo-btn-container").appendChild(u)}function Q(t,e){U(),J(),Y(),b(t.meta.fields,e),P(),_(),G(),M(t.data,e),m=new p({container:document.querySelector(".chart-container"),parsedLog:t.data,defaultField:e}),m.draw()}function Z(t){let e=document.querySelector(".third-step");e.querySelector("#form").remove();let i=document.createElement("h1");i.textContent="Please, select the default field",e.appendChild(i);let n=document.createElement("form"),o=document.createElement("select");for(let c of t.meta.fields)if(V(c)){let a=document.createElement("option");a.setAttribute("value",c),a.textContent=c,o.appendChild(a)}let r=document.createElement("button");r.textContent="Create chart",r.setAttribute("type","button"),r.addEventListener("click",()=>{Q(t,o.value)}),n.appendChild(o),n.appendChild(r),e.appendChild(n)}document.getElementById("log_input").addEventListener("change",tt);document.getElementById("example").addEventListener("click",et);function tt(){let t=document.getElementById("log_input").files[0];if(!E(t))return I("Please upload only CSV files!");X(t)}async function et(){X(await v())}var m,N;function X(t){Papa.parse(t,{header:!0,encoding:"latin3",skipEmptyLines:!0,transformHeader:function(e){return e.replace("\uFFFD","\xB0")},complete:function(e){B(e.meta.fields)?(N=e.meta.fields,Z(e)):I("Please send only logs from HWInfo!")}})}document.addEventListener("DOMContentLoaded",()=>{let t=localStorage.getItem("theme");document.documentElement.setAttribute("data-theme",t||"light")});})();
